{% extends 'base.html' %}
{% load static %}

{% block title %}Solicitação de Empréstimo{% endblock %}

{% block content %}

<div class="container justify-content-center mx-auto shadow p-4 w-75">
    {% if context %}
    <h4>Entre na fila!</h4>
    <p>Abaixo está a data de previsão para que você possa pegar o livro emprestado e quantas pessoas estão à sua frente
        na lista de espera.</p>

    <div class="row">
        <div class="col col-5">
            <div class="card" style="width: 18rem;">
                <div class="card-header">
                    <h4 class="card-title">{{ context.book.title }}</h4>
                    {% if context.book.subtitle %}
                    <h6 class="card-subtitle mb-2 text-muted">{{ context.book.subtitle|default_if_none:""}}</h6>
                    {% endif %}
                </div>
                <div class="card-body">
                    <img class="card-img" src="{{ context.book.picture_url }}" alt="{{ context.book.title }}">
                </div>
                <div class="card-footer">
                    <div class="row">
                        <div class="col col-12 text-muted">
                            <i class="fa-solid fa-language"></i>
                            {{ context.book.language }}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col col-12">
                            <i class="fa-solid fa-feather-pointed"></i>
                            <a href="{% url 'library:author' context.book.author_id %}"
                                class="card-link">{{ context.book.author }}</a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col col-12">
                            <i class="fa-solid fa-print"></i>
                            <a href="{{ context.book.publisher.website }}"
                                class="card-link">{{ context.book.publisher }}</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col col-7">
            <div class="row">
                <div class="col">
                    Pessoas à sua frente: <strong class="text-primary">{{context.members}}</strong>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    Data disponível para você: <strong
                        class="text-primary">{{context.next_date|date:"D d/M/Y"}}</strong>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col col-12 text-center">
                    <h4>Deseja entrar na fila?</h4>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col col-12 text-center">
                    <form method="post">
                        <input type="hidden" name="book_id" id="book_id" value="{{ context.book.id }}" />
                        <input type="hidden" name="next_date" id="next_date"
                            value="{{context.next_date|date:"d/m/Y"}}" />
                        {% csrf_token %}
                        <input type="submit" value="Quero participar!" class="btn btn-primary">
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    {% if confirmation %}
    <div class="row">
        <div class="col col-5">
            <div class="card" style="width: 18rem;">
                <div class="card-header">
                    <h4 class="card-title">{{ confirmation.queue.book.title }}</h4>
                    {% if confirmation.queue.book.subtitle %}
                    <h6 class="card-subtitle mb-2 text-muted">{{ confirmation.queue.book.subtitle|default_if_none:""}}
                    </h6>
                    {% endif %}
                </div>
                <div class="card-body">
                    <img class="card-img" src="{{ confirmation.queue.book.picture_url }}"
                        alt="{{ confirmation.queue.book.title }}">
                </div>
                <div class="card-footer">
                    <div class="row">
                        <div class="col col-12 text-muted">
                            <i class="fa-solid fa-language"></i>
                            {{ confirmation.queue.book.language }}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col col-12">
                            <i class="fa-solid fa-feather-pointed"></i>
                            <a href="{% url 'library:author' confirmation.queue.book.author_id %}"
                                class="card-link">{{ confirmation.queue.book.author }}</a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col col-12">
                            <i class="fa-solid fa-print"></i>
                            <a href="{{ context.book.publisher.website }}"
                                class="card-link">{{ confirmation.queue.book.publisher }}</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col col-7">
            <h4>Você está na fila!</h4>
            <div class="row mt-3">
                <div class="col">
                    A data prevista para seu empréstimo é {{ confirmation.queue.expected_date|date:"D d/M/Y" }}.
                </div>
            </div>
            <div class="row">
                <div class="col">
                    Você está na {{ confirmation.position }}ª posição na fila.
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    {% endif %}
</div>
{% endblock %}